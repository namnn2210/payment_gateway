{% extends "layout/layout.html" %}
{% load humanize %}
{% block title %}Bank History{% endblock %}
{% block content %}
<div class="container-fluid">
    <div class="row">
        <nav class="col-md-2">
            <div class="card">
                <div class="card-body">
                  <!-- List group with Links and buttons -->
                  <div class="list-group choose-bank">
                    <button type="button" class="list-group-item list-group-item-action" aria-current="true">
                        ALL
                      </button>
                    {% for bank in list_user_bank %}
                    <button type="button" class="list-group-item list-group-item-action" aria-current="true">
                      {{bank.account_number}} - {{bank.bank_name}}
                    </button>
                    {% endfor %}
                    </div><!-- End List group with Links and buttons -->
                    <div class="list-group choose-filter">
                        <button type="button" class="list-group-item list-group-item-action active" aria-current="true">
                          10 latest histories
                        </button>
                        <button type="button" class="list-group-item list-group-item-action">Today</button>
                        <button type="button" class="list-group-item list-group-item-action">Yesterday</button>
                        <button type="button" class="list-group-item list-group-item-action">7 latest days</button>
                        <button type="button" class="list-group-item list-group-item-action">This week</button>
                        <button type="button" class="list-group-item list-group-item-action">Last week</button>
                        <button type="button" class="list-group-item list-group-item-action">30 latest days</button>
                        <button type="button" class="list-group-item list-group-item-action">All time</button>
                      </div><!-- End List group with Links and buttons -->
    
                </div>
            </div>
            
        </nav>
        <main role="main" class="col-md-10 ml-sm-auto px-4">
            <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                <h1 class="h2">Transaction History</h1>
            </div>
            <div class="table-responsive">
                <table class="table table-striped table-sm">
                    <thead>
                        <tr>
                            <th>.check</th>
                            <th>Ref</th>
                            <th>Account</th>
                            <th>Virtual</th>
                            <th>Money</th>
                            <th>Date</th>
                            <th>Memo</th>
                            <th>.code</th>
                            <th>.name</th>
                        </tr>
                    </thead>
                    <tbody id="transactionTableBody">
                        {% if page_obj.object_list %}
                        {% for history in page_obj.object_list %}
                        <tr>
                            <td>âœ”</td>
                            <td>{{ history.transaction_number }}</td>
                            <td>{{ history.account }}</td>
                            <td>{{ history.virtual }}</td>
                            <td>{{ history.money | intcomma }}</td>
                            <td>{{ history.date }}</td>
                            <td>{{ history.memo }}</td>
                            <td>{{ history.code }}</td>
                            <td>{{ history.name }}</td>
                        </tr>
                        {% endfor %}
                        {% else %}
                        <tr>
                            <td colspan="9">No data found.</td>
                        </tr>
                        {% endif %}
                    </tbody>
                </table>
            </div>
            <div class="pagination">
                <span class="step-links">
                    {% if page_obj.has_previous %}
                    <a href="?page=1">&laquo; first</a>
                    <a href="?page={{ page_obj.previous_page_number }}">previous</a>
                    {% endif %}

                    <span class="current">
                        Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}.
                    </span>

                    {% if page_obj.has_next %}
                    <a href="?page={{ page_obj.next_page_number }}">next</a>
                    <a href="?page={{ page_obj.paginator.num_pages }}">last &raquo;</a>
                    {% endif %}
                </span>
            </div>
        </main>
    </div>
</div>
{% endblock %}
{% block script %}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function () {
        // Handle search by memo
        $('#searchMemo').on('keyup', function () {
            var value = $(this).val().toLowerCase();
            $('#transactionTableBody tr').filter(function () {
                $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1);
            });
        });

        // Handle filter buttons
        $('.filter-buttons .btn-secondary').on('click', function () {
            $('.filter-buttons .btn-secondary').removeClass('active');
            $(this).addClass('active');
            var filter = $(this).data('filter');
            filterTransactions(filter);
        });

        function filterTransactions(filter) {
            var today = new Date();
            var startDate, endDate;

            if (filter === 'all') {
                $('#transactionTableBody tr').show();
                return;
            }

            if (filter === 'today') {
                startDate = endDate = today;
            } else if (filter === 'yesterday') {
                startDate = endDate = new Date(today.setDate(today.getDate() - 1));
            } else if (filter === 'this_week') {
                var dayOfWeek = today.getDay();
                startDate = new Date(today.setDate(today.getDate() - dayOfWeek));
                endDate = new Date(today.setDate(today.getDate() + (6 - dayOfWeek)));
            } else if (filter === 'last_week') {
                var dayOfWeek = today.getDay();
                startDate = new Date(today.setDate(today.getDate() - dayOfWeek - 7));
                endDate = new Date(today.setDate(today.getDate() + 6));
            } else if (filter === 'last_30_days') {
                startDate = new Date(today.setDate(today.getDate() - 30));
                endDate = today;
            }

            $('#transactionTableBody tr').each(function () {
                var date = new Date($(this).find('td:eq(5)').text());
                if (date >= startDate && date <= endDate) {
                    $(this).show();
                } else {
                    $(this).hide();
                }
            });
        }
    });
</script>
{% endblock %}
